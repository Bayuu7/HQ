# Penetration Test Report

Summary:
- No critical vulnerabilities found.
- Medium 
#!/bin/bash
# update_auth.sh
# Script untuk menambahkan JWT authentication ke ApiGateway dan update client SDK

set -euo pipefail

echo "ðŸ” Updating ApiGateway with JWT authentication..."

########################################
# Update ApiGateway.py
########################################
cat > src/services/ApiGateway.py <<'EOF'
# ApiGateway.py (update dengan JWT auth)

from flask import Flask, request, jsonify
from src.services.JobOrchestrator import JobOrchestrator
import jwt, datetime

app = Flask(__name__)
orchestrator = JobOrchestrator(debug=True)

SECRET_KEY = "supersecret"   # ganti dengan env var di production
DEBUG_MODE = True

def generate_token(user_id: str):
    payload = {
        "user_id": user_id,
        "exp": datetime.datetime.utcnow() + datetime.timedelta(hours=1)
    }
    return jwt.encode(payload, SECRET_KEY, algorithm="HS256")

def verify_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        return payload
    except jwt.ExpiredSignatureError:
        return None
    except jwt.InvalidTokenError:
        return None

@app.route("/v1/auth/login", methods=["POST"])
def login():
    data = request.json or {}
    user_id = data.get("user_id", "guest")
    token = generate_token(user_id)
    return jsonify({"token": token})

@app.route("/v1/models/generate", methods=["POST"])
def generate_model():
    auth_header = request.headers.get("Authorization")
    if not auth_header or not auth_header.startswith("Bearer "):
        return jsonify({"error": "Unauthorized"}), 401
    token = auth_header.split(" ")[1]
    if not verify_token(token):
        return jsonify({"error": "Invalid token"}), 401

    data = request.json or {}
    prompt = data.get("prompt", "")
    if DEBUG_MODE:
        print(f"[DEBUG] Received prompt: {prompt}")
    job_id = orchestrator.submit_job({"type": "text-to-3d", "prompt": prompt})
    return jsonify({"jobId": job_id, "status": "queued"})
